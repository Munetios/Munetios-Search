<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Word Hunt</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lexend&display=swap">
  <style>
    /* GRAY THEME STYLING */
    body {
      font-family: 'Lexend', Arial, sans-serif;
      text-align: center;
      background: #444;           /* Dark gray background */
      margin: 0;
      padding: 0;
      color: #eee;                /* Light text */
    }
    .hidden {
      display: none;
    }
    #main-menu, #game-options, #game-container {
      margin-top: 50px;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      background: #666;         /* Medium gray */
      color: #eee;
      border: none;
      border-radius: 3px;
    }
    button:hover {
      background: #777;
    }
    /* Board styling */
    #board {
      display: inline-block;
      margin-top: 20px;
    }
    .row {
      display: flex;
    }
    .cell {
      width: 50px;
      height: 50px;
      border: 1px solid #888;
      margin: 2px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      background: #666;
      cursor: pointer;
      user-select: none;
    }
    .cell-input {
      width: 50px;
      height: 50px;
      text-align: center;
      font-size: 20px;
      margin: 2px;
      border: 1px solid #888;
      background: #555;
      color: #eee;
    }
    /* Highlighted (drag-selected) cell */
    .selected {
      background-color: #aaa;
      color: #222;
    }
    /* Timer & control panel styling */
    #timer {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #controls {
      margin-top: 20px;
    }
    #player-info {
      margin-top: 10px;
      font-weight: bold;
    }
    /* Words list styling */
    #words-list {
      margin-top: 10px;
      font-size: 14px;
      text-align: left;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }
    /* End popup styling */
    #end-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
    }
    .popup-content {
      background: #666;
      color: #eee;
      padding: 20px;
      margin: 15% auto;
      width: 300px;
      border-radius: 5px;
      border: 1px solid #888;
    }
  </style>
</head>
<body>
  <!-- Main Menu -->
  <div id="main-menu">
    <h1>Word Hunt</h1>
<p> Note that its currently outdated so that was last updated March 2025</p>
    <button id="play-random">Play Random Word Hunt</button>
    <button id="create-wordhunt">Create Word Hunt</button>
  </div>

  <!-- Game Options: Choose Board Size and Player Mode -->
  <div id="game-options" class="hidden">
    <h2>Choose Your Game Settings</h2>
    <label for="board-size">Board Size:</label>
    <select id="board-size">
      <option value="4">4 x 4</option>
      <option value="5">5 x 5</option>
      <option value="6">6 x 6</option>
      <option value="7">7 x 7</option>
    </select>
    <br>
    <label for="player-mode">Player Mode:</label>
    <select id="player-mode">
      <option value="1">1 Player</option>
      <option value="2">2 Players</option>
    </select>
    <br>
    <button id="start-game">Start Game</button>
  </div>

  <!-- Game Container -->
  <div id="game-container" class="hidden">
    <div id="timer">2:00</div>
    <div id="board"></div>
    <!-- For Create mode only -->
    <button id="confirm-board" class="hidden">Confirm Board</button>
    <!-- Control Panel -->
    <div id="controls">
      <div id="current-word">Current Word: </div>
      <button id="submit-word">Submit Word</button>
      <button id="clear-selection">Clear Selection</button>
      <div id="player-info"></div>
      <div id="words-list">No words submitted yet.</div>
    </div>
  </div>

  <!-- End Game Popup -->
  <div id="end-popup" class="hidden">
    <div class="popup-content">
      <h2>Time's Up!</h2>
      <div id="final-results"></div>
      <button id="restart">Back to Main Menu</button>
    </div>
  </div>

  <script>
    // Global variables
    let gameMode = "random"; // "random" or "create"
    let numPlayers = 1;      // 1 or 2
    let currentPlayer = 1;
    let playerScores = {};
    // Each player's words is an array of objects: { word: "WORD", points: 400 }
    let playerWords = {};
    let currentWord = "";
    let selectedCells = [];
    let timerInterval;
    let remainingTime = 120; // seconds per turn
    let boardSize = 4;
    let isDragging = false;  // for drag selection

    // Scoring function based on word length.
    function getScore(word) {
      const len = word.length;
      const scoring = {
        3: 100,
        4: 400,
        5: 800,
        6: 1400,
        7: 1800,
        8: 2200,
        9: 2600,
        10: 3000,
        11: 3400,
        12: 3800,
        13: 4200,
        14: 4600,
        15: 5000,
        16: 5400,
        17: 5800,
        18: 6200
      };
      return scoring[len] || 0;
    }

    // Utility: Play a sound (update paths as needed)
    function playSound(src) {
      const sound = new Audio(src);
      sound.play();
    }

    // Utility: Show only the selected section
    function showSection(id) {
      document.getElementById("main-menu").classList.add("hidden");
      document.getElementById("game-options").classList.add("hidden");
      document.getElementById("game-container").classList.add("hidden");
      document.getElementById("end-popup").classList.add("hidden");
      document.getElementById(id).classList.remove("hidden");
    }

    // Update the display of the current word.
    function updateCurrentWordDisplay() {
      document.getElementById("current-word").innerText = "Current Word: " + currentWord;
    }

    // Update player info (score and turn).
    function updatePlayerInfo() {
      let info = "";
      if (numPlayers === 1) {
        info = "Score: " + playerScores[1];
      } else {
        info = "Player 1: " + playerScores[1] + " pts, Player 2: " + playerScores[2] +
               ". Current Turn: Player " + currentPlayer;
      }
      document.getElementById("player-info").innerText = info;
    }

    // Update the displayed words list for the current player.
    // The list is sorted in descending order by points.
    function updateWordsList() {
      const listDiv = document.getElementById("words-list");
      let words = playerWords[currentPlayer];
      if (words.length > 0) {
        // Create a shallow copy and sort by points descending.
        let sortedWords = words.slice().sort((a, b) => b.points - a.points);
        let listHTML = "<strong>Words Submitted:</strong><br>";
        sortedWords.forEach(obj => {
          listHTML += obj.word + " (" + obj.points + " pts)<br>";
        });
        listDiv.innerHTML = listHTML;
      } else {
        listDiv.innerHTML = "No words submitted yet.";
      }
    }

    // Clear the current letter selection.
    function clearSelection() {
      currentWord = "";
      selectedCells.forEach(cell => cell.classList.remove("selected"));
      selectedCells = [];
      updateCurrentWordDisplay();
    }

    // Add a cell to the selection if it is adjacent to the last selected cell.
    function addCellToSelection(cell) {
      if (cell.classList.contains("selected")) return;
      if (selectedCells.length > 0) {
        let lastCell = selectedCells[selectedCells.length - 1];
        let lastRow = parseInt(lastCell.dataset.row);
        let lastCol = parseInt(lastCell.dataset.col);
        let newRow = parseInt(cell.dataset.row);
        let newCol = parseInt(cell.dataset.col);
        // Allow only if adjacent (including diagonally)
        if (Math.abs(lastRow - newRow) > 1 || Math.abs(lastCol - newCol) > 1) {
          return;
        }
      }
      cell.classList.add("selected");
      currentWord += cell.innerText;
      selectedCells.push(cell);
      updateCurrentWordDisplay();
    }

    // Attach drag (mouse/touch) events to a cell.
    function attachDragEvents(cell) {
      cell.addEventListener("mousedown", function() {
        isDragging = true;
        addCellToSelection(cell);
      });
      cell.addEventListener("mouseenter", function() {
        if (isDragging) {
          addCellToSelection(cell);
        }
      });
      cell.addEventListener("touchstart", function(e) {
        e.preventDefault();
        isDragging = true;
        addCellToSelection(cell);
      });
      cell.addEventListener("touchmove", function(e) {
        e.preventDefault();
        let touch = e.touches[0];
        let elem = document.elementFromPoint(touch.clientX, touch.clientY);
        if (elem && elem.classList.contains("cell")) {
          addCellToSelection(elem);
        }
      });
    }

    // Global event to end dragging.
    document.addEventListener("mouseup", function() { isDragging = false; });
    document.addEventListener("touchend", function() { isDragging = false; });

    // Create a random board with grid coordinates and attach drag events.
    function createRandomBoard(size) {
      const boardDiv = document.getElementById("board");
      boardDiv.innerHTML = "";
      for (let i = 0; i < size; i++) {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("row");
        for (let j = 0; j < size; j++) {
          const cellDiv = document.createElement("div");
          cellDiv.classList.add("cell");
          cellDiv.dataset.row = i;
          cellDiv.dataset.col = j;
          const letter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
          cellDiv.innerText = letter;
          attachDragEvents(cellDiv);
          rowDiv.appendChild(cellDiv);
        }
        boardDiv.appendChild(rowDiv);
      }
    }

    // Create a custom board with input fields.
    function createCustomBoard(size) {
      const boardDiv = document.getElementById("board");
      boardDiv.innerHTML = "";
      for (let i = 0; i < size; i++) {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("row");
        for (let j = 0; j < size; j++) {
          const inputField = document.createElement("input");
          inputField.type = "text";
          inputField.maxLength = 1;
          inputField.classList.add("cell-input");
          inputField.addEventListener("input", function() {
            this.value = this.value.toUpperCase();
          });
          rowDiv.appendChild(inputField);
        }
        boardDiv.appendChild(rowDiv);
      }
      document.getElementById("confirm-board").classList.remove("hidden");
    }

    // Convert custom board inputs into a clickable board.
    function convertCustomBoardToGameBoard(size) {
      const boardDiv = document.getElementById("board");
      const inputs = boardDiv.querySelectorAll("input");
      let letters = [];
      for (const input of inputs) {
        if (input.value.trim() === "") {
          alert("Please fill in all cells with a letter.");
          return false;
        }
        letters.push(input.value.trim());
      }
      boardDiv.innerHTML = "";
      let index = 0;
      for (let i = 0; i < size; i++) {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("row");
        for (let j = 0; j < size; j++) {
          const cellDiv = document.createElement("div");
          cellDiv.classList.add("cell");
          cellDiv.dataset.row = i;
          cellDiv.dataset.col = j;
          cellDiv.innerText = letters[index++];
          attachDragEvents(cellDiv);
          rowDiv.appendChild(cellDiv);
        }
        boardDiv.appendChild(rowDiv);
      }
      return true;
    }

    // Format seconds into "M:SS" format.
    function formatTime(seconds) {
      const min = Math.floor(seconds / 60);
      const sec = seconds % 60;
      return min + ":" + (sec < 10 ? "0" + sec : sec);
    }

    // Start (or restart) a turn timer (for 2-player mode).
    function startTurnTimer(seconds) {
      remainingTime = seconds;
      document.getElementById("timer").innerText = formatTime(remainingTime);
      timerInterval = setInterval(() => {
        remainingTime--;
        document.getElementById("timer").innerText = formatTime(remainingTime);
        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          if (numPlayers === 2) {
            if (currentPlayer === 1) {
              alert("Player 1's turn has ended. Now it's Player 2's turn!");
              currentPlayer = 2;
              clearSelection();
              updatePlayerInfo();
              updateWordsList();
              startTurnTimer(120);
            } else {
              endGame();
            }
          } else {
            endGame();
          }
        }
      }, 1000);
    }

    // End the game and show final results (words & points for both players).
    function endGame() {
      playSound("end.mp3");
      let finalMessage = "";
      if (numPlayers === 1) {
        // Sort player 1's words by points descending.
        let sorted = playerWords[1].slice().sort((a, b) => b.points - a.points);
        finalMessage = "Your Score: " + playerScores[1] + "<br><br>Words Submitted:<br>";
        sorted.forEach(obj => {
          finalMessage += obj.word + " (" + obj.points + " pts)<br>";
        });
      } else {
        // Sort words for each player.
        let sorted1 = playerWords[1].slice().sort((a, b) => b.points - a.points);
        let sorted2 = playerWords[2].slice().sort((a, b) => b.points - a.points);
        if (playerScores[1] > playerScores[2]) {
          finalMessage = "Player 1 wins! " + playerScores[1] + " vs " + playerScores[2] + "<br><br>";
        } else if (playerScores[2] > playerScores[1]) {
          finalMessage = "Player 2 wins! " + playerScores[2] + " vs " + playerScores[1] + "<br><br>";
        } else {
          finalMessage = "It's a draw! " + playerScores[1] + " vs " + playerScores[2] + "<br><br>";
        }
        finalMessage += "Player 1 Words:<br>";
        sorted1.forEach(obj => {
          finalMessage += obj.word + " (" + obj.points + " pts)<br>";
        });
        finalMessage += "<br>Player 2 Words:<br>";
        sorted2.forEach(obj => {
          finalMessage += obj.word + " (" + obj.points + " pts)<br>";
        });
      }
      document.getElementById("final-results").innerHTML = finalMessage;
      showSection("end-popup");
    }

    // --- EVENT LISTENERS ---

    // Main Menu: Choose game mode.
    document.getElementById("play-random").addEventListener("click", () => {
      gameMode = "random";
      showSection("game-options");
      playSound("click.mp3");
    });
    document.getElementById("create-wordhunt").addEventListener("click", () => {
      gameMode = "create";
      showSection("game-options");
      playSound("click.mp3");
    });

    // Start Game (after choosing settings).
    document.getElementById("start-game").addEventListener("click", () => {
      boardSize = parseInt(document.getElementById("board-size").value);
      numPlayers = parseInt(document.getElementById("player-mode").value);
      currentPlayer = 1;
      playerScores = {};
      playerWords = {};
      playerScores[1] = 0;
      playerWords[1] = [];
      if (numPlayers === 2) {
        playerScores[2] = 0;
        playerWords[2] = [];
      }
      updatePlayerInfo();
      updateWordsList();
      showSection("game-container");
      document.getElementById("confirm-board").classList.add("hidden");
      document.getElementById("board").innerHTML = "";
      clearSelection();
      if (gameMode === "random") {
        createRandomBoard(boardSize);
        startTurnTimer(120);
        playSound("start.mp3");
      } else if (gameMode === "create") {
        createCustomBoard(boardSize);
      }
    });

    // Confirm Board for custom board mode.
    document.getElementById("confirm-board").addEventListener("click", () => {
      if (convertCustomBoardToGameBoard(boardSize)) {
        document.getElementById("confirm-board").classList.add("hidden");
        startTurnTimer(120);
        playSound("start.mp3");
      }
    });

    // Submit Word: Validate (min 3 letters), calculate score, update data, and update word list.
    document.getElementById("submit-word").addEventListener("click", () => {
      if (currentWord.length < 3) {
        alert("Word too short! Must be at least 3 letters.");
        return;
      }
      let points = getScore(currentWord);
      playerScores[currentPlayer] += points;
      playerWords[currentPlayer].push({ word: currentWord, points: points });
      alert("Player " + currentPlayer + " submitted \"" + currentWord + "\" for " + points + " pts!");
      updatePlayerInfo();
      updateWordsList();
      clearSelection();
    });

    // Clear current letter selection.
    document.getElementById("clear-selection").addEventListener("click", clearSelection);

    // Restart game (back to Main Menu).
    document.getElementById("restart").addEventListener("click", () => {
      clearInterval(timerInterval);
      showSection("main-menu");
      playSound("click.mp3");
    });
  </script>
</body>
</html>
